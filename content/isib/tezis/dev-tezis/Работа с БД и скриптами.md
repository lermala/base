---
title: Работа с БД и скриптами
weight: 10
---

Здесь информация конкретно под СЭД Тезис и PostgreSQL.

## Как развернуть дамп
Заходим по пути, где установлен PostgreSQL. Обычно это C:\Program Files\PostgreSQL\13\bin

В командной строке прописываем:

```
psql.exe -U cuba dbname < dumpname.dump
```

## SQL
Примечание. Если заливаем скрипт через Тезис, а не напрямую через СУБД, то вместо точек с запятой `;` используем знак `^`. Далее в примерах используется `;`

### Очистка БД
#### Посмотреть размер БД
Вместо `dbname` указываем название нужной БД:

```
SELECT pg_size_pretty(pg_database_size('dbname')) AS size;
```

#### Очистка БД от временных файлов

```
DELETE FROM SEC_ENTITY_LOG;
DELETE FROM sys_sending_attachment;
DELETE FROM SYS_SENDING_MESSAGE;

DELETE FROM SYS_QUERY_RESULT;

TRUNCATE SYS_SCHEDULED_EXECUTION;
```

Скрипт может долго выполняться особенно для больших БД. Рекомендую запускать команды поочередно, но можно запустить и паком.
При этом служба Тезис будет работать, процесс работы БД можно посмотреть командой `htop` в командной строке (linux): 

![alt text](image.png)


#### Очистка БД от карточек
Под каждую БД скрипт нужно переделывать в зависимости от модели данных. Ниже пример для БД проекта Братск.

```
тут будет пример
```

## JPQL 
### Оператор LIKE в JPQL
Если необходимо сравнить строковое значение в JPQL запросе, то можно воспользоваться оператором LIKE. Пример:

```
select distinct d from bratsk$ExtSimpleDoc d 
where d.docOfficeData.receivingMethod.name LIKE 'Холдинг'
and d.state LIKE ',Registration,'
```

При использовании `LIKE` в сравниваемой строке можно указать шаблон:

- Символ процента `%` - which matches zero or more of any character.
- Нижнее подчеркивание `_` - which matches any single character.

Примеры:

```
SELECT e FROM Employee e WHERE e.salary LIKE '_500' order by e.salary
--Employee\{id=4, name='Mike', dept='H_R', salary=3500\}
    SELECT e FROM Employee e WHERE e.name LIKE 'D%'
--Employee\{id=1, name='Diana', dept='IT', salary=3000\}
--Employee\{id=3, name='Denise', dept='Admin', salary=4000\}
SELECT e FROM Employee e WHERE e.name NOT LIKE 'D%'
--Employee\{id=2, name='Rose', dept='Sales', salary=2000\}
--Employee\{id=4, name='Mike', dept='H_R', salary=3500\}
SELECT e FROM Employee e WHERE e.dept LIKE '%@_%' ESCAPE '@'
--Employee{id=4, name='Mike', dept='H_R', salary=3500}
```

Источник:   [JPA + Hibernate - JPQL LIK](https://www.logicbig.com/tutorials/java-ee-tutorial/jpa/jpql-like-expression.html)